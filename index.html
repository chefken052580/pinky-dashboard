<!-- CodeBot View - Replace Coming Soon with Real UI -->
<div id="code-view" class="view" style="display: none;">
  <div class="code-dashboard">
    <div class="code-header">
      <h2>ü§ñ CodeBot - Repository Analysis</h2>
      <button class="refresh-btn" onclick="refreshCodeData()">üîÑ Refresh</button>
    </div>
    
    <!-- Recent Commits Section -->
    <div class="code-section">
      <h3>üìù Recent Commits</h3>
      <div id="commits-list" class="commits-container">
        <div class="loading">Loading commits...</div>
      </div>
    </div>
    
    <!-- Code Stats Section -->
    <div class="code-section">
      <h3>üìä Repository Statistics</h3>
      <div id="code-stats" class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">JavaScript Files</div>
          <div class="stat-value" id="js-files">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total JS Lines</div>
          <div class="stat-value" id="js-lines">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Last Week: Added</div>
          <div class="stat-value stat-positive" id="lines-added">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Last Week: Removed</div>
          <div class="stat-value stat-negative" id="lines-removed">-</div>
        </div>
      </div>
    </div>
    
    <!-- Syntax Errors Section -->
    <div class="code-section">
      <h3>‚ö†Ô∏è Recent Syntax Errors</h3>
      <div id="syntax-errors" class="errors-container">
        <div class="loading">Loading error log...</div>
      </div>
    </div>
  </div>
</div>

<style>
.code-dashboard {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.code-header h2 {
  margin: 0;
  color: var(--primary-color, #667eea);
}

.refresh-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: transform 0.2s;
}

.refresh-btn:hover {
  transform: scale(1.05);
}

.code-section {
  background: #1a1a2e;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid #667eea;
}

.code-section h3 {
  margin-top: 0;
  color: #00d4ff;
  font-size: 18px;
}

.commits-container {
  max-height: 400px;
  overflow-y: auto;
}

.commit-card {
  background: #16213e;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  border-left: 4px solid #667eea;
}

.commit-hash {
  font-family: monospace;
  color: #00d4ff;
  font-weight: bold;
  margin-right: 10px;
}

.commit-author {
  color: #888;
  font-size: 12px;
}

.commit-message {
  margin: 5px 0;
  color: #fff;
}

.commit-stats {
  font-size: 12px;
  color: #888;
  margin-top: 5px;
}

.stat-positive {
  color: #4CAF50 !important;
}

.stat-negative {
  color: #f44336 !important;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.stat-card {
  background: #16213e;
  padding: 15px;
  border-radius: 8px;
  text-align: center;
}

.stat-label {
  font-size: 12px;
  color: #888;
  margin-bottom: 5px;
}

.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: #00d4ff;
}

.errors-container {
  max-height: 300px;
  overflow-y: auto;
}

.error-card {
  background: #2d1b1b;
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 6px;
  border-left: 4px solid #f44336;
}

.error-file {
  font-family: monospace;
  color: #ff6b6b;
  font-size: 13px;
}

.error-message {
  color: #fff;
  margin: 5px 0;
  font-size: 13px;
}

.error-timestamp {
  font-size: 11px;
  color: #888;
}

.loading, .empty-state {
  text-align: center;
  padding: 40px;
  color: #888;
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: 1fr 1fr;
  }
}
</style>

<script>
async function loadCodeData() {
  try {
    // Load commits
    const commitsRes = await fetch('http://192.168.254.4:3030/api/code/commits?limit=10');
    const commitsData = await commitsRes.json();
    renderCommits(commitsData.commits || []);
    
    // Load stats
    const statsRes = await fetch('http://192.168.254.4:3030/api/code/stats');
    const statsData = await statsRes.json();
    renderStats(statsData.stats);
    
    // Load errors
    const errorsRes = await fetch('http://192.168.254.4:3030/api/code/errors');
    const errorsData = await errorsRes.json();
    renderErrors(errorsData.errors || []);
  } catch (error) {
    console.error('Error loading code data:', error);
  }
}

function renderCommits(commits) {
  const container = document.getElementById('commits-list');
  if (!commits.length) {
    container.innerHTML = '<div class="empty-state">No recent commits found</div>';
    return;
  }
  
  container.innerHTML = commits.map(commit => `
    <div class="commit-card">
      <div>
        <span class="commit-hash">${commit.hash}</span>
        <span class="commit-author">${commit.author} ‚Ä¢ ${commit.time}</span>
      </div>
      <div class="commit-message">${commit.message}</div>
      <div class="commit-stats">
        üìÅ ${commit.stats.files} files | 
        <span class="stat-positive">+${commit.stats.additions}</span> | 
        <span class="stat-negative">-${commit.stats.deletions}</span>
      </div>
    </div>
  `).join('');
}

function renderStats(stats) {
  if (!stats) return;
  document.getElementById('js-files').textContent = stats.files.javascript || '0';
  document.getElementById('js-lines').textContent = (stats.lines.javascript || 0).toLocaleString();
  document.getElementById('lines-added').textContent = '+' + (stats.lastWeek.additions || 0).toLocaleString();
  document.getElementById('lines-removed').textContent = '-' + (stats.lastWeek.deletions || 0).toLocaleString();
}

function renderErrors(errors) {
  const container = document.getElementById('syntax-errors');
  if (!errors.length) {
    container.innerHTML = '<div class="empty-state">‚úÖ No syntax errors logged</div>';
    return;
  }
  
  container.innerHTML = errors.map(error => `
    <div class="error-card">
      <div class="error-file">${error.file}</div>
      <div class="error-message">${error.error}</div>
      <div class="error-timestamp">${error.timestamp}</div>
    </div>
  `).join('');
}

function refreshCodeData() {
  document.getElementById('commits-list').innerHTML = '<div class="loading">Refreshing...</div>';
  document.getElementById('syntax-errors').innerHTML = '<div class="loading">Refreshing...</div>';
  loadCodeData();
}

// Auto-load when view is shown
document.addEventListener('DOMContentLoaded', () => {
  const codeBtn = document.querySelector('[data-view="code-view"]');
  if (codeBtn) {
    codeBtn.addEventListener('click', () => {
      setTimeout(loadCodeData, 100);
    });
  }
});
</script>
